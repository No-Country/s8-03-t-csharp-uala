@page "/Register"
@layout LoginLayout
@inject IAuthService AuthService
@inject NavigationManager NavigationManager
@inject ISnackbar Snackbar
<PageTitle>Registro</PageTitle>
<MudStack Justify="Justify.Center" AlignItems="AlignItems.Center">
    <MudText>Introduzca sus datos</MudText>
</MudStack>
<MudGrid>
    <MudItem md="6" sm="12">
        <MudTextField T="string" @bind-Value="@_registerModel.Name" Label="Nombre" Variant="Variant.Outlined"/>
    </MudItem>
    <MudItem md="6" sm="12">
        <MudTextField T="string" @bind-Value="@_registerModel.Email" Label="Correo Electrónico" Variant="Variant.Outlined"/>
    </MudItem>
    <MudItem md="6" sm="12">
        <MudTextField T="string" @bind-Value="@_registerModel.Username" Label="Nombre de usuario" Variant="Variant.Outlined"/>
    </MudItem>
    <MudItem md="6" sm="12">
        <MudTextField T="string" @bind-Value="@_registerModel.Password" Label="Contraseña" Variant="Variant.Outlined"/>
    </MudItem>
    <MudItem md="6" sm="12">
        <MudTextField T="string" @bind-Value="@_registerModel.ConfirmPassword" Label="Confirmar contraseña" Variant="Variant.Outlined"/>
    </MudItem>
    <MudItem md="6" sm="12">
        <MudTextField T="string" @bind-Value="@_registerModel.Road" Label="Calle" Variant="Variant.Outlined"/>
    </MudItem>
    <MudItem md="6" sm="12">
        <MudTextField T="string" @bind-Value="@_registerModel.Province" Label="Provincia" Variant="Variant.Outlined"/>
    </MudItem>
    <MudItem md="6" sm="12">
        <MudTextField T="string" @bind-Value="@_registerModel.City" Label="Ciudad" Variant="Variant.Outlined"/>
    </MudItem>
    <MudItem md="6" sm="12">
        <MudTextField T="string" @bind-Value="@_registerModel.ZipCode" Label="Código postal" Variant="Variant.Outlined"/>
    </MudItem>

</MudGrid>
<MudStack Row="true" Justify="Justify.FlexEnd" AlignItems="AlignItems.Center" Class="my-4">
    <MudLink Href="/Login">¿Tienes una cuenta?</MudLink>
</MudStack>

<MudButton Variant="Variant.Filled" Color="MudBlazor.Color.Primary" OnClick="HandleRegister" Size="Size.Large" FullWidth="true">Registrate</MudButton>

<MudDivider></MudDivider>
<MudStack Justify="Justify.Center" AlignItems="AlignItems.Center" Class="my-4">
    <MudText Class="my-2" Color="Color.Dark" Typo="Typo.subtitle1">Alau Tecnologias, 2023</MudText>
</MudStack>
@code
{
    private readonly RegisterModel _registerModel = new RegisterModel();
    private async Task HandleRegister()
    {
        var result = await AuthService.Register(_registerModel);
        if (result.Status is "Success")
        {
            NavigationManager.NavigateTo("/Login");
        }
        else
        {
            Snackbar.Add(result.Message, Severity.Error, config => { config.ShowCloseIcon = true; config.ShowTransitionDuration = 150; config.HideTransitionDuration = 150; config.VisibleStateDuration = 1000; });
        }
    }
}
